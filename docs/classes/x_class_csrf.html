<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Bugfish - PHP CSRF Class</title> <!------------------------------------>
    <meta name="description" content="Welcome to the bugfish framework github page! Here you can find informations about: Bugfish - PHP CSRF Class"> <!------------------------------------>
    <meta name="author" content="Bugfish">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <link href="../style.css" rel="stylesheet" type="text/css" />
	<link rel="icon" type="image/x-icon" href="../favicon.ico"><meta property="og:image" content="../meta.png" />
		<link rel="canonical" href="https://bugfishtm.github.io/bugfish-framework/classes/x_class_csrf.html" />
	<meta property="og:title" content="Bugfish - PHP CSRF Class" />
	<meta property="og:url" content="https://bugfishtm.github.io/bugfish-framework/classes/x_class_csrf.html" />
	 <link rel="stylesheet" href="../stylesheet.css">
	 <script src="../jquery.js"></script> 
	 <script src="../datatable.js"></script> 
	 <script>
		function internal_show(newshowvar, thiselement) {
			$(".internal_show").hide();
			$(".test").hide();
			$("#"+newshowvar).show();
			$(".navitts").css('color', '');
			thiselement.css('color', '#ff0c02');
		}
		
		
		$( document ).ready(function() {
			$(".internal_show").hide();
			$("#show_php").show();
			$(".startactivenav").css('color', '#ff0c02');
		});		
	 </script>
  </head>
  <body>
<img src="../logo.png" style="width: 100%; margin-bottom: -7px;">    <a href="#header"><div class="gobacktotop"><b>^ Back to Top</b></div></a>   
    <header id="header">
	  
      <h1> CSRF Class</h1>Bugfish Framework <!------------------------------------>
      
      <ul class="main-menu">
        <li><a href="../index.html">Back</a></li>
        <li><a href="#" class="navon">PHP CSRF</a></li>
        <li><a href="https://github.com/bugfishtm/bugfish-framework" target="_blank">Github</a></li>
        <li><a href="https://bugfish.eu" target="_blank" rel="noopener">Bugfish</a></li>
        <li><a href="../impressum.html">Impressum</a></li>
        <li><a href="../privacy.html">Privacy</a></li>
      </ul>                   
    </header>
   
    <div>

				<div class="inner inner_section" style="text-align: center;">
<h2 id="x_class_csrf-mastered-">Bugfish - PHP CSRF Class </h2>
The x_class_csrf class is designed to manage Cross-Site Request Forgery (CSRF) prevention by generating, validating, and maintaining CSRF tokens within sessions. It provides methods to retrieve tokens, validate submissions, and handle token renewal.

<div style="max-width: 500px;text-align: left; background: 161616;">✔️ Tested<br />
✔️ Productive - Ready<br />
⚠️ Does use Session-Cookies<br />
<br /></div>
<h2 id="x_class-mastered-">How to use x_class_csrf?</h2>
<table>
<thead>
<tr>
<th>Method/Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Class Initialization</strong></td>
<td></td>
</tr>
<tr>
<td><code>__construct($cookie_extension = &quot;&quot;, $second_valid = 300, $external_action = false)</code></td>
<td>Constructor method for initializing the class. It accepts three optional parameters: <code>cookie_extension</code> (string) for adding an extension to session keys, <code>second_valid</code> (integer) for setting the validity time of CSRF keys in seconds, and <code>external_action</code> (boolean) for disabling key renewal.</td>
</tr>
<tr>
<td><strong>Key Generation and Retrieval</strong></td>
<td></td>
</tr>
<tr>
<td><code>getField($name, $id = &quot;&quot;)</code></td>
<td>Generates and echoes an HTML input hidden field with the current CSRF key. You can provide an optional <code>name</code> and <code>id</code> attributes for the field.</td>
</tr>
<tr>
<td><code>crypto()</code></td>
<td>Returns the CSRF key for the current session or the last session key, depending on whether external actions are enabled.</td>
</tr>
<tr>
<td><code>time()</code></td>
<td>Returns the timestamp of when the current CSRF key or last session key was generated, depending on whether external actions are enabled.</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td></td>
</tr>
<tr>
<td><code>validate($code, $override_valid_time = false)</code></td>
<td>Validates a given CSRF key (<code>$code</code>) against the current or last session key, depending on whether external actions are enabled. You can optionally override the validity time (in seconds) by providing <code>$override_valid_time</code>. Returns <code>true</code> if the key is valid, <code>false</code> otherwise.</td>
</tr>
<tr>
<td><code>check($code, $override_valid_time = false)</code></td>
<td>Checks if the provided CSRF key (<code>$code</code>) is valid for the current session. You can optionally override the validity time (in seconds) by providing <code>$override_valid_time</code>. Returns <code>true</code> if the key is valid, <code>false</code> otherwise.</td>
</tr>
<tr>
<td><code>check_lkey($code, $override_valid_time = false)</code></td>
<td>Checks if the provided CSRF key (<code>$code</code>) is valid for the last session, if external actions are enabled. You can optionally override the validity time (in seconds) by providing <code>$override_valid_time</code>. Returns <code>true</code> if the key is valid, <code>false</code> otherwise.</td>
</tr>
<tr>
<td><strong>Disabling Key Renewal</strong></td>
<td></td>
</tr>
<tr>
<td><code>disableRenewal($bool = false)</code></td>
<td>Sets the <code>$norenewal</code> property to <code>true</code> or <code>false</code> to disable or enable key renewal for the current session.</td>
</tr>
<tr>
<td><code>norenewal($bool = false)</code></td>
<td>An alias for <code>disableRenewal()</code>. Sets the <code>$norenewal</code> property to <code>true</code> or <code>false</code>.</td>
</tr>
<tr>
<td><strong>External Action</strong></td>
<td></td>
</tr>
<tr>
<td><code>external_action($bool = false)</code></td>
<td>Enables or disables external actions mode by setting the <code>$external_action</code> property to <code>true</code> or <code>false</code>. In external actions mode, the class uses the last session key for validation.</td>
</tr>
<tr>
<td><strong>Session Cleanup</strong></td>
<td></td>
</tr>
<tr>
<td><code>__destruct()</code></td>
<td>Deconstructor method that stores the current CSRF key and its timestamp in the session if key renewal is not disabled (<code>$norenewal</code> is <code>false</code>).</td>
</tr>
</tbody>
</table>
<h2 id="x_class_mastered-">Example Implementation</h2>
<textarea style="max-width: 100%; min-width: 100%; width: 100%; background: black; color: yellow;height: 400px; resize-x: none;" readonly>
// Initialize the CSRF class with optional parameters
$csrf = new x_class_csrf("myapp_", 600, true);

// Generate and echo a hidden input field with the CSRF key
$csrf->getField("csrf_token", "csrf_input");

// Validate a submitted CSRF key
if ($csrf->validate($_POST['csrf_token'])) {
    // CSRF key is valid, perform the action
} else {
    // CSRF key is invalid, handle the error
}

// Optionally, disable key renewal for the current session
$csrf->disableRenewal(true);

// Optionally, enable external actions mode
$csrf->external_action(true);

// Check a submitted CSRF key against the last session key
if ($csrf->validate($_POST['csrf_token'])) {
    // CSRF key is valid for external actions, perform the action
} else {
    // CSRF key is invalid for external actions, handle the error
}

</textarea>


</div>


				
 
    </div>
    
  </body>
</html>